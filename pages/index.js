import Head from 'next/head'
import { useContext, useEffect } from 'react';
import Home from '../components/Home/Home'
import {fetchAPI} from '../lib/api';
import {collectionContext} from '../context/CollectionsContext';

export default function HomePage({hero,favorites,housegood,collections}) {
  
  const {setCollections} = useContext(collectionContext);

  useEffect(()=>{
    setCollections(collections);
  },[])
  

  return (
    <div>
      <Head>
        <title>Smoking Accessories & Home Goods | WoodHouse</title>
        <meta name="description" content="Generated by create next app" />
        <link rel="icon" href="./favicon.png" />
      </Head>
      <Home hero={hero} favorites={favorites} housegood={housegood}/>
    </div>
  )
}


export async function getStaticProps() {
  
  let hero = await fetchAPI('/heroes',{
    populate:['image','product','product.images']
  });

  hero = hero.data;
  
  
  let favorites = await fetchAPI('/favorite',{
    populate:['products','products.images']
  });

  favorites = favorites.data.attributes.products.data;
  
  
  let housegood = await fetchAPI('/housegood',{
    populate:['products','products.images']
  });

  housegood = housegood.data.attributes.products.data;

  
  let collections = await fetchAPI(`/collections`,{});
    
  collections=collections.data;


  return{
    props:{hero,favorites,housegood,collections}
  }
}